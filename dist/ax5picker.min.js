"use strict";!function(){var t=ax5.ui,e=ax5.util;t.addClass({className:"picker",version:"0.7.9"},function(){var t=function(){var t,i=this;this.instanceId=ax5.getGuid(),this.config={clickEventName:"click",theme:"default",title:"",lang:{ok:"ok",cancel:"cancel"},animateTime:250},this.queue=[],this.activePicker=null,this.activePickerQueueIndex=-1,this.openTimer=null,this.closeTimer=null,t=this.config;var n=function(t,e){return t&&t.onStateChanged?t.onStateChanged.call(e,e):this.onStateChanged&&this.onStateChanged.call(e,e),!0},a=function(){var i={focus:function(t,e){this.open(t)},click:function(t,e){this.open(t)}},n={"@fn":function(e,i){var n=this.queue[e],a={},u=i.length;a={inputLength:u||1},u>1&&(a.btns={ok:{label:t.lang.ok,theme:t.theme}}),this.queue[e]=jQuery.extend(!0,a,n),a=null,u=null},date:function(e,i){var n=this.queue[e],a=n.content?n.content.width||270:270,u=n.content?n.content.margin||5:5,l={},s=i.length;l={contentWidth:a*s+(s-1)*u,content:{width:a,margin:u},inputLength:s||1},s>1&&!n.btns&&(l.btns={ok:{label:t.lang.ok,theme:t.theme}}),this.queue[e]=jQuery.extend(!0,l,n),a=null,u=null,l=null,s=null},"secure-num":function(t,e){var i=this.queue[t],n={},a=e.length;n={inputLength:a||1},this.queue[t]=jQuery.extend(!0,n,i),n=null,a=null},keyboard:function(t,e){var i=this.queue[t],n={},a=e.length;n={inputLength:a||1},this.queue[t]=jQuery.extend(!0,n,i),n=null,a=null},numpad:function(t,e){var i=this.queue[t],n={},a=e.length;n={inputLength:a||1},this.queue[t]=jQuery.extend(!0,n,i),n=null,a=null}};return function(t){var a,u=this.queue[t];if(!u.content)return console.log(ax5.info.getError("ax5picker","501","bind")),this;if(a="INPUT"==u.$target.get(0).tagName.toUpperCase()?u.$target:u.$target.find("input[type]"),e.isFunction(u.content))n["@fn"].call(this,t,a);else for(var l in n)if(u.content.type==l){n[l].call(this,t,a);break}return a.unbind("focus.ax5picker").unbind("click.ax5picker").bind("focus.ax5picker",i.focus.bind(this,t)).bind("click.ax5picker",i.click.bind(this,t)),u.$target.find(".input-group-addon").unbind("click.ax5picker").bind("click.ax5picker",i.click.bind(this,t)),u.content.formatter&&ax5.ui.formatter&&a.ax5formatter(u.content.formatter),a=null,u=null,t=null,this}}(),u=function(t){return'\n                    <div class="ax5-ui-picker {{theme}}" id="{{id}}" data-picker-els="root">\n                        {{#title}}\n                            <div class="ax-picker-heading">{{title}}</div>\n                        {{/title}}\n                        <div class="ax-picker-body">\n                            <div class="ax-picker-content" data-picker-els="content" style="width:{{contentWidth}}px;"></div>\n                            {{#btns}}\n                                <div class="ax-picker-buttons">\n                                {{#btns}}\n                                    {{#@each}}\n                                    <button data-picker-btn="{{@key}}" class="btn btn-default {{@value.theme}}">{{@value.label}}</button>\n                                    {{/@each}}\n                                {{/btns}}\n                                </div>\n                            {{/btns}}\n                        </div>\n                        <div class="ax-picker-arrow"></div>\n                    </div>\n                    '},l=function(t){if(!this.activePicker)return this;var e,i=jQuery(window),n=jQuery(document.body),a=this.queue[this.activePickerQueueIndex],u={},l=12,s={},c={};t&&jQuery(document.body).append(this.activePicker),u=a.$target.offset(),s={width:a.$target.outerWidth(),height:a.$target.outerHeight()},c={winWidth:Math.max(i.width(),n.width()),winHeight:Math.max(i.height(),n.height()),width:this.activePicker.outerWidth(),height:this.activePicker.outerHeight()},a.direction&&""!==a.direction&&"auto"!==a.direction?e=a.direction:(e="top",u.top-c.height-l<0?e="top":u.top+s.height+c.height+l>c.winHeight&&(e="bottom")),t&&this.activePicker.addClass("direction-"+e);var r=function(){var t={left:0,top:0};switch(e){case"top":t.left=u.left+s.width/2-c.width/2,t.top=u.top+s.height+l;break;case"bottom":t.left=u.left+s.width/2-c.width/2,t.top=u.top-c.height-l;break;case"left":t.left=u.left+s.width+l,t.top=u.top-c.height/2+s.height/2;break;case"right":t.left=u.left-c.width-l,t.top=u.top-c.height/2+s.height/2}return t}();(function(){("top"==e||"bottom"==e)&&(r.left<0?(r.left=l,this.activePickerArrow.css({left:u.left+s.width/2-r.left})):r.left+c.width>c.winWidth&&(r.left=c.winWidth-c.width-l,this.activePickerArrow.css({left:u.left+s.width/2-r.left})))}).call(this),this.activePicker.css(r)},s=function(t,i){if(!this.activePicker)return this;var n=this.queue[this.activePickerQueueIndex];return i=e.findParentNode(t.target,function(t){return t.getAttribute("data-picker-els")?!0:n.$target.get(0)==t?!0:void 0}),i?this:(this.close(),this)},c=function(t,i){if(t.srcElement&&(t.target=t.srcElement),i=e.findParentNode(t.target,function(t){return t.getAttribute("data-picker-btn")?!0:void 0})){var n=this.queue[this.activePickerQueueIndex],a=i.getAttribute("data-picker-btn");if(n.btns&&n.btns[a].onClick){var u={key:a,value:n.btns[a],self:this,item:n};n.btns[a].onClick.call(u,a)}else this.close()}},r=function(t){t.keyCode==ax5.info.eventKeys.ESC&&this.close()},h=function(t){return e.isString(t)||(t=jQuery(t).data("data-axpicker-id")),e.isString(t)?e.search(this.queue,function(){return this.id==t}):void console.log(ax5.info.getError("ax5picker","402","getQueIdx"))};this.init=function(){this.onStateChanged=t.onStateChanged},this.bind=function(i){var n,u={};return i=jQuery.extend(!0,u,t,i),i.target?(i.$target=jQuery(i.target),i.$target.get(0)?(i.id||(i.id=i.$target.data("data-axpicker-id")),i.id||(i.id="ax5-picker-"+ax5.getGuid(),i.$target.data("data-axpicker-id",i.id)),n=e.search(this.queue,function(){return this.id==i.id}),-1===n?(this.queue.push(i),a.call(this,this.queue.length-1)):(this.queue[n]=jQuery.extend(!0,{},this.queue[n],i),a.call(this,n)),u=null,n=null,this):(console.log(ax5.info.getError("ax5picker","401","bind")),this)):(console.log(ax5.info.getError("ax5picker","401","bind")),this)},this.setContentValue=function(t,a,u){var l,s=e.isNumber(t)?t:h.call(this,t),c=this.queue[s];return c&&(l="INPUT"==c.$target.get(0).tagName.toUpperCase()?c.$target:jQuery(c.$target.find("input[type]").get(a)),l.val(u),n.call(this,c,{self:i,state:"changeValue",item:c,value:u}),1==c.inputLength&&this.close()),c=null,t=null,a=null,u=null,this},this.open=function(){var a={"@fn":function(t,e){var i=this.queue[t];return i.content.call(i,function(t){e(t)}),!0},date:function(t){for(var n=this.queue[t],a=[],u=0;u<n.inputLength;u++)a.push('<div style="width:'+e.cssNumber(n.content.width)+';float:left;" class="ax-picker-content-box" data-calendar-target="'+u+'"></div>'),u<n.inputLength-1&&a.push('<div style="width:'+n.content.margin+'px;float:left;height: 5px;"></div>');a.push('<div style="clear:both;"></div>'),n.pickerContent.html(a.join(""));var l={displayDate:new Date,control:{left:'<i class="fa fa-chevron-left"></i>',yearTmpl:"%s",monthTmpl:"%s",right:'<i class="fa fa-chevron-right"></i>',yearFirst:!0}},s="INPUT"==n.$target.get(0).tagName.toUpperCase()?n.$target:n.$target.find("input[type]");n.pickerContent.find("[data-calendar-target]").each(function(){var t=this.getAttribute("data-calendar-target"),e=s.get(t).value,a=ax5.util.date(e);l.displayDate=a,e&&(l.selection=[a]),l=jQuery.extend(!0,l,n.content.config||{}),l.target=this,l.onClick=function(){i.setContentValue(n.id,t,this.date)},new ax5.ui.calendar(l)})},"secure-num":function(t){for(var a=this.queue[t],u=[],l=0;l<a.inputLength;l++)u.push('<div style="width:'+e.cssNumber(a.content.width)+';float:left;" class="ax-picker-content-box" data-secure-num-target="'+l+'"></div>'),l<a.inputLength-1&&u.push('<div style="width:'+a.content.margin+'px;float:left;height: 5px;"></div>');u.push('<div style="clear:both;"></div>'),a.pickerContent.html(u.join("")),a.pickerContent.find("[data-secure-num-target]").each(function(){var t=this.getAttribute("data-secure-num-target"),e=[],u=function(t){var e,i,n;for(n=t.length;n;n-=1)e=Math.floor(Math.random()*n),i=t[n-1],t[n-1]=t[e],t[e]=i;return t}([0,1,2,3,4,5,6,7,8,9]),l=[{label:"&#x02190",fn:"back"},{label:"C",fn:"clear"}];u.forEach(function(t){e.push('<div style="float:left;'+a.content.config.btnWrapStyle+'">'),e.push('<button class="btn btn-default btn-'+a.content.config.btnTheme+'" style="'+a.content.config.btnStyle+'" data-secure-num-value="'+t+'">'+t+"</button>"),e.push("</div>")}),l.forEach(function(t){e.push('<div style="float:left;'+a.content.config.btnWrapStyle+'">'),e.push('<button class="btn btn-default btn-'+a.content.config.specialBtnTheme+'" style="'+a.content.config.btnStyle+'" data-secure-num-value="'+t.fn+'">'+t.label+"</button>"),e.push("</div>")}),e.push('<div style="clear:both;"></div>'),$(this).html(e.join("")).on("click","[data-secure-num-value]",function(){var e=this.getAttribute("data-secure-num-value"),u="INPUT"==a.$target.get(0).tagName.toUpperCase()?a.$target:jQuery(a.$target.find("input[type]").get(t)),l=u.val();"back"==e?u.val(l.substring(0,l.length-1)):"clear"==e?u.val(""):u.val(l+e),n.call(this,a,{self:i,state:"changeValue",item:a,value:u.val()})})})},keyboard:function(t){for(var a=this.queue[t],u=[],l=0;l<a.inputLength;l++)u.push('<div style="width:'+e.cssNumber(a.content.width)+';float:left;" class="ax-picker-content-box" data-keyboard-target="'+l+'"></div>'),l<a.inputLength-1&&u.push('<div style="width:'+a.content.margin+'px;float:left;height: 5px;"></div>');u.push('<div style="clear:both;"></div>'),a.pickerContent.html(u.join(""));var s=[[{value:"`",shiftValue:"~"},{value:"1",shiftValue:"!"},{value:"2",shiftValue:"@"},{value:"3",shiftValue:"#"},{value:"4",shiftValue:"$"},{value:"5",shiftValue:"%"},{value:"6",shiftValue:"^"},{value:"7",shiftValue:"&"},{value:"8",shiftValue:"*"},{value:"9",shiftValue:"("},{value:"0",shiftValue:")"},{value:"-",shiftValue:"_"},{value:"=",shiftValue:"+"},{label:"&#x02190",fn:"back"}],[{value:"q",shiftValue:"Q"},{value:"w",shiftValue:"W"},{value:"e",shiftValue:"E"},{value:"r",shiftValue:"R"},{value:"t",shiftValue:"T"},{value:"y",shiftValue:"Y"},{value:"u",shiftValue:"U"},{value:"i",shiftValue:"I"},{value:"o",shiftValue:"O"},{value:"p",shiftValue:"P"},{value:"[",shiftValue:"{"},{value:"]",shiftValue:"}"},{value:"\\",shiftValue:"|"}],[{label:"Clear",fn:"clear"},{value:"a",shiftValue:"A"},{value:"s",shiftValue:"S"},{value:"d",shiftValue:"D"},{value:"f",shiftValue:"F"},{value:"g",shiftValue:"G"},{value:"h",shiftValue:"H"},{value:"j",shiftValue:"J"},{value:"k",shiftValue:"K"},{value:"l",shiftValue:"L"},{value:";",shiftValue:":"},{value:"'",shiftValue:'"'}],[{label:"Shift",fn:"shift"},{value:"z",shiftValue:"Z"},{value:"x",shiftValue:"X"},{value:"c",shiftValue:"C"},{value:"v",shiftValue:"V"},{value:"b",shiftValue:"B"},{value:"n",shiftValue:"N"},{value:"m",shiftValue:"M"},{value:",",shiftValue:"<"},{value:".",shiftValue:">"},{value:"/",shiftValue:"?"},{label:"Close",fn:"close"}]],c=function(t){var e=[];return s.forEach(function(i){e.push('<div style="display: table;margin:0 auto;">'),i.forEach(function(i){var n,u,l,s,c;i.fn?(n=i.fn,u=i.label,l=a.content.config.specialBtnWrapStyle,s=a.content.config.specialBtnTheme,c=a.content.config.specialBtnStyle):(u=n=t?i.shiftValue:i.value,l=a.content.config.btnWrapStyle,s=a.content.config.btnTheme,c=a.content.config.btnStyle),e.push('<div style="display: table-cell;'+l+'">'),e.push('<button class="btn btn-default btn-'+s+'" style="'+c+'" data-keyboard-value="'+n+'">'+u+"</button>"),e.push("</div>")}),e.push("</div>")}),e.join("")};a.pickerContent.find("[data-keyboard-target]").each(function(){var t=this.getAttribute("data-keyboard-target"),e=$(this),u=!1,l=function(){u=!u,e.html(c(u))};e.html(c(u)).on("mousedown","[data-keyboard-value]",function(){var e=this.getAttribute("data-keyboard-value"),u="INPUT"==a.$target.get(0).tagName.toUpperCase()?a.$target:jQuery(a.$target.find("input[type]").get(t)),s=u.val();switch(e){case"back":u.val(s.substring(0,s.length-1));break;case"clear":u.val("");break;case"shift":return l(),!1;case"close":return i.close(),!1;default:u.val(s+e)}n.call(this,a,{self:i,state:"changeValue",item:a,value:u.val()})})})},numpad:function(t){for(var a=this.queue[t],u=[],l=0;l<a.inputLength;l++)u.push('<div style="width:'+e.cssNumber(a.content.width)+';float:left;" class="ax-picker-content-box" data-numpad-target="'+l+'"></div>'),l<a.inputLength-1&&u.push('<div style="width:'+a.content.margin+'px;float:left;height: 5px;"></div>');u.push('<div style="clear:both;"></div>'),a.pickerContent.html(u.join("")),a.pickerContent.find("[data-numpad-target]").each(function(){var t=this.getAttribute("data-numpad-target"),e=[],u=a.content.config.keyArray||[{value:"7"},{value:"8"},{value:"9"},{label:"BS",fn:"back"},{value:"4"},{value:"5"},{value:"6"},{label:"CLS",fn:"clear"},{value:"1"},{value:"2"},{value:"3"},{value:""},{value:"."},{value:"0"},{value:""},{label:"OK",fn:"enter"}];u.forEach(function(t){var i,n,u,l,s;t.fn?(i=t.fn,n=t.label,l=a.content.config.specialBtnTheme,u=a.content.config.specialBtnWrapStyle,s=a.content.config.specialBtnStyle):(n=i=t.value,l=i?a.content.config.btnTheme:"",u=a.content.config.btnWrapStyle,s=a.content.config.btnStyle),e.push('<div style="float:left;'+u+'">'),e.push('<button class="btn btn-default btn-'+l+'" style="'+s+'" data-numpad-value="'+i+'">'+(n||"&nbsp;")+"</button>"),e.push("</div>")}),e.push('<div style="clear:both;"></div>'),$(this).html(e.join("")).on("mousedown","[data-numpad-value]",function(){var e=this.getAttribute("data-numpad-value"),u="INPUT"==a.$target.get(0).tagName.toUpperCase()?a.$target:jQuery(a.$target.find("input[type]").get(t)),l=u.val(),s="";switch(e){case"back":s="changeValue",u.val(l.substring(0,l.length-1));break;case"clear":s="changeValue",u.val("");break;case"enter":return i.close(a,"enter"),!1;case"close":return i.close(),!1;default:s="changeValue",u.val(l+e)}n.call(this,a,{self:i,state:s,item:a,value:u.val()})})})}};return function(i,o){var d=e.isNumber(i)?i:h.call(this,i),f=this.queue[d];return this.openTimer&&clearTimeout(this.openTimer),this.activePicker?this.activePickerQueueIndex==d?this:o>2?this:(this.close(),this.openTimer=setTimeout(function(){this.open(d,(o||0)+1)}.bind(this),t.animateTime),this):(this.activePicker=jQuery(ax5.mustache.render(u.call(this,f,d),f)),this.activePickerArrow=this.activePicker.find(".ax-picker-arrow"),this.activePickerQueueIndex=d,f.pickerContent=this.activePicker.find('[data-picker-els="content"]'),e.isFunction(f.content)?(f.pickerContent.html("Loading.."),a["@fn"].call(this,d,function(t){f.pickerContent.html(t)})):f.content.type in a&&a[f.content.type].call(this,d),this.activePicker.find("[data-picker-btn]").on(t.clickEventName,function(t){c.call(this,t||window.event,d)}.bind(this)),l.call(this,"append"),jQuery(window).bind("resize.ax5picker",function(){l.call(this)}.bind(this)),jQuery(window).bind("keyup.ax5picker",function(t){t=t||window.event,r.call(this,t),e.stopEvent(t)}.bind(this)),jQuery(window).bind("click.ax5picker",function(t){t=t||window.event,s.call(this,t),e.stopEvent(t)}.bind(this)),n.call(this,f,{self:this,state:"open",item:f}),this)}}(),this.close=function(e,i){return this.closeTimer&&clearTimeout(this.closeTimer),this.activePicker?(e=this.queue[this.activePickerQueueIndex],this.activePicker.addClass("destroy"),jQuery(window).unbind("resize.ax5picker"),jQuery(window).unbind("click.ax5picker"),jQuery(window).unbind("keyup.ax5picker"),this.closeTimer=setTimeout(function(){this.activePicker&&this.activePicker.remove(),this.activePicker=null,this.activePickerQueueIndex=-1,n.call(this,e,{self:this,state:i||"close"})}.bind(this),t.animateTime),this):this},this.main=function(){arguments&&e.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};return t}())}(),ax5.ui.picker_instance=new ax5.ui.picker,jQuery.fn.ax5picker=function(){return function(t){if(ax5.util.isString(arguments[0])){var e=arguments[0];switch(e){case"open":return ax5.ui.select_instance.open(this);case"close":return ax5.ui.select_instance.close(this);case"setValue":return ax5.ui.select_instance.setContentValue(this,arguments[1],arguments[2]);default:return this}}else"undefined"==typeof t&&(t={}),jQuery.each(this,function(){var e={target:this};t=jQuery.extend(!0,t,e),ax5.ui.picker_instance.bind(t)});return this}}();