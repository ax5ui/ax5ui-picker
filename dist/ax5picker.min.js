"use strict";!function(t,e){var i=ax5.util,n=function(){var t,n=this;e&&e.call(this),this.queue=[],this.config={clickEventName:"click",theme:"default",title:"",lang:{ok:"ok",cancel:"cancel"},animateTime:250},this.activePicker=null,this.activePickerQueueIndex=-1,this.openTimer=null,this.closeTimer=null,t=this.config;var a=function(t,e){return t&&t.onStateChanged?t.onStateChanged.call(e,e):this.onStateChanged&&this.onStateChanged.call(e,e),!0},c=function(){var e={focus:function(t,e){this.open(t)},click:function(t,e){this.open(t)}},n={"@fn":function(e){var i=this.queue[e],n={},a=i.$target.find('input[type="text"]').length;n={inputLength:a||1},a>1&&(n.btns={ok:{label:t.lang.ok,theme:t.theme}}),this.queue[e]=jQuery.extend(!0,n,i),n=null,a=null},date:function(e){var i=this.queue[e],n=i.content?i.content.width||270:270,a=i.content?i.content.margin||5:5,c={},r=i.$target.find('input[type="text"]').length;c={contentWidth:n*r+(r-1)*a,content:{width:n,margin:a},inputLength:r||1},r>1&&!i.btns&&(c.btns={ok:{label:t.lang.ok,theme:t.theme}}),this.queue[e]=jQuery.extend(!0,c,i),n=null,a=null,c=null,r=null},"secure-num":function(t){var e=this.queue[t],i={},n=e.$target.find('input[type="text"]').length;i={inputLength:n||1},this.queue[t]=jQuery.extend(!0,i,e),i=null,n=null}};return function(t){var a,c=this.queue[t];if(!c.content)return console.log(ax5.info.getError("ax5picker","501","bind")),this;if(i.isFunction(c.content))n["@fn"].call(this,t);else for(var r in n)if(c.content.type==r){n[r].call(this,t);break}return a="INPUT"==c.$target.get(0).tagName.toUpperCase()?c.$target:c.$target.find("input[type]"),a.unbind("focus.ax5picker").unbind("click.ax5picker").bind("focus.ax5picker",e.focus.bind(this,t)).bind("click.ax5picker",e.click.bind(this,t)),c.$target.find(".input-group-addon").unbind("click.ax5picker").bind("click.ax5picker",e.click.bind(this,t)),c.content.formatter&&ax5.ui.formatter&&a.ax5formatter(c.content.formatter),a=null,c=null,t=null,this}}(),r=function(t){return'\n                <div class="ax5-ui-picker {{theme}}" id="{{id}}" data-picker-els="root">\n                    {{#title}}\n                        <div class="ax-picker-heading">{{title}}</div>\n                    {{/title}}\n                    <div class="ax-picker-body">\n                        <div class="ax-picker-content" data-picker-els="content" style="width:{{contentWidth}}px;"></div>\n                        {{#btns}}\n                            <div class="ax-picker-buttons">\n                            {{#btns}}\n                                {{#@each}}\n                                <button data-picker-btn="{{@key}}" class="btn btn-default {{@value.theme}}">{{@value.label}}</button>\n                                {{/@each}}\n                            {{/btns}}\n                            </div>\n                        {{/btns}}\n                    </div>\n                    <div class="ax-picker-arrow"></div>\n                </div>\n                '},s=function(t){if(!this.activePicker)return this;var e=this.queue[this.activePickerQueueIndex],i={},n={};t&&jQuery(document.body).append(this.activePicker),i=e.$target.offset(),n={width:e.$target.outerWidth(),height:e.$target.outerHeight()},e.direction&&""!==e.direction&&"auto"!==e.direction||(e.direction="top"),t&&this.activePicker.addClass("direction-"+e.direction),this.activePicker.css(function(){return"top"==e.direction?{left:i.left+n.width/2-this.activePicker.outerWidth()/2,top:i.top+n.height+12}:"bottom"==e.direction?{left:i.left+n.width/2-this.activePicker.outerWidth()/2,top:i.top-this.activePicker.outerHeight()-12}:"left"==e.direction?{left:i.left+n.width+12,top:i.top-n.height/2}:"right"==e.direction?{left:i.left-this.activePicker.outerWidth()-12,top:i.top-n.height/2}:void 0}.call(this))},u=function(t,e){if(!this.activePicker)return this;var n=this.queue[this.activePickerQueueIndex];return e=i.findParentNode(t.target,function(t){return t.getAttribute("data-picker-els")?!0:n.$target.get(0)==t?!0:void 0}),e?this:(this.close(),this)},l=function(t,e){if(t.srcElement&&(t.target=t.srcElement),e=i.findParentNode(t.target,function(t){return t.getAttribute("data-picker-btn")?!0:void 0})){var n=this.queue[this.activePickerQueueIndex],a=e.getAttribute("data-picker-btn");if(n.btns&&n.btns[a].onClick){var c={key:a,value:n.btns[a],self:this,item:n};n.btns[a].onClick.call(c,a)}else this.close()}},o=function(t){t.keyCode==ax5.info.eventKeys.ESC&&this.close()},h=function(t){return i.isString(t)||(t=jQuery(t).data("data-axpicker-id")),i.isString(t)?i.search(this.queue,function(){return this.id==t}):void console.log(ax5.info.getError("ax5picker","402","getQueIdx"))};this.init=function(){this.onStateChanged=t.onStateChanged},this.bind=function(e){var n,a={};return e=jQuery.extend(!0,a,t,e),e.target?(e.$target=jQuery(e.target),e.$target.get(0)?(e.id||(e.id=e.$target.data("data-axpicker-id")),e.id||(e.id="ax5-picker-"+ax5.getGuid(),e.$target.data("data-axpicker-id",e.id)),n=i.search(this.queue,function(){return this.id==e.id}),-1===n?(this.queue.push(e),c.call(this,this.queue.length-1)):(this.queue[n]=jQuery.extend(!0,{},this.queue[n],e),c.call(this,n)),a=null,n=null,this):(console.log(ax5.info.getError("ax5picker","401","bind")),this)):(console.log(ax5.info.getError("ax5picker","401","bind")),this)},this.setContentValue=function(t,e,c){var r,s=i.isNumber(t)?t:h.call(this,t),u=this.queue[s];return u&&(r="INPUT"==u.$target.get(0).tagName.toUpperCase()?u.$target:jQuery(u.$target.find("input[type]").get(e)),r.val(c),a.call(this,u,{self:n,state:"changeValue",item:u,value:c}),1==u.inputLength&&this.close()),u=null,t=null,e=null,c=null,this},this.open=function(){var e={"@fn":function(t,e){var i=this.queue[t];return i.content.call(i,function(t){e(t)}),!0},date:function(t){for(var e=this.queue[t],a=[],c=0;c<e.inputLength;c++)a.push('<div style="width:'+i.cssNumber(e.content.width)+';float:left;" class="ax-picker-content-box" data-calendar-target="'+c+'"></div>'),c<e.inputLength-1&&a.push('<div style="width:'+e.content.margin+'px;float:left;height: 5px;"></div>');a.push('<div style="clear:both;"></div>'),e.pickerContent.html(a.join(""));var r={displayDate:new Date,control:{left:'<i class="fa fa-chevron-left"></i>',yearTmpl:"%s",monthTmpl:"%s",right:'<i class="fa fa-chevron-right"></i>',yearFirst:!0}};e.pickerContent.find("[data-calendar-target]").each(function(){var t=this.getAttribute("data-calendar-target"),i=e.$target.find("input[type]").get(t).value,a=ax5.util.date(i);r.displayDate=a,i&&(r.selection=[a]),r=jQuery.extend(!0,r,e.content.config||{}),r.target=this,r.onClick=function(){n.setContentValue(e.id,t,this.date)},new ax5.ui.calendar(r)})},"secure-num":function(t){for(var e=this.queue[t],c=[],r=0;r<e.inputLength;r++)c.push('<div style="width:'+i.cssNumber(e.content.width)+';float:left;" class="ax-picker-content-box" data-secure-num-target="'+r+'"></div>'),r<e.inputLength-1&&c.push('<div style="width:'+e.content.margin+'px;float:left;height: 5px;"></div>');c.push('<div style="clear:both;"></div>'),e.pickerContent.html(c.join("")),e.pickerContent.find("[data-secure-num-target]").each(function(){var t=this.getAttribute("data-secure-num-target"),i=[],c=function(t){var e,i,n;for(n=t.length;n;n-=1)e=Math.floor(Math.random()*n),i=t[n-1],t[n-1]=t[e],t[e]=i;return t}([0,1,2,3,4,5,6,7,8,9]),r=[{label:"&#x02190",fn:"back"},{label:"C",fn:"clear"}];c.forEach(function(t){i.push('<div style="float:left;'+e.content.config.btnWrapStyle+'">'),i.push('<button class="btn btn-default btn-'+e.content.config.btnTheme+'" style="'+e.content.config.btnStyle+'" data-secure-num-value="'+t+'">'+t+"</button>"),i.push("</div>")}),r.forEach(function(t){i.push('<div style="float:left;'+e.content.config.btnWrapStyle+'">'),i.push('<button class="btn btn-default btn-'+e.content.config.specialBtnTheme+'" style="'+e.content.config.btnStyle+'" data-secure-num-value="'+t.fn+'">'+t.label+"</button>"),i.push("</div>")}),i.push('<div style="clear:both;"></div>'),$(this).html(i.join("")).find("[data-secure-num-value]").click(function(){var i=this.getAttribute("data-secure-num-value"),c="INPUT"==e.$target.get(0).tagName.toUpperCase()?e.$target:jQuery(e.$target.find("input[type]").get(t)),r=c.val();"back"==i?c.val(r.substring(0,r.length-1)):"clear"==i?c.val(""):c.val(r+i),a.call(this,e,{self:n,state:"changeValue",item:e,value:c.val()})})})}};return function(n,c){var d=i.isNumber(n)?n:h.call(this,n),f=this.queue[d];if(this.openTimer&&clearTimeout(this.openTimer),this.activePicker)return this.activePickerQueueIndex==d?this:c>2?this:(this.close(),this.openTimer=setTimeout(function(){this.open(d,(c||0)+1)}.bind(this),t.animateTime),this);if(this.activePicker=jQuery(ax5.mustache.render(r.call(this,f,d),f)),this.activePickerQueueIndex=d,f.pickerContent=this.activePicker.find('[data-picker-els="content"]'),i.isFunction(f.content))f.pickerContent.html("Loading.."),e["@fn"].call(this,d,function(t){f.pickerContent.html(t)});else for(var p in e)if(f.content.type==p){e[p].call(this,d);break}return this.activePicker.find("[data-picker-btn]").on(t.clickEventName,function(t){l.call(this,t||window.event,d)}.bind(this)),s.call(this,"append"),jQuery(window).bind("resize.ax5picker",function(){s.call(this)}.bind(this)),jQuery(window).bind("keyup.ax5picker",function(t){t=t||window.event,o.call(this,t),i.stopEvent(t)}.bind(this)),jQuery(window).bind("click.ax5picker",function(t){t=t||window.event,u.call(this,t),i.stopEvent(t)}.bind(this)),a.call(this,f,{self:this,state:"open",item:f}),this}}(),this.close=function(e){return this.closeTimer&&clearTimeout(this.closeTimer),this.activePicker?(e=this.queue[this.activePickerQueueIndex],this.activePicker.addClass("destroy"),jQuery(window).unbind("resize.ax5picker"),jQuery(window).unbind("click.ax5picker"),jQuery(window).unbind("keyup.ax5picker"),this.closeTimer=setTimeout(function(){this.activePicker&&this.activePicker.remove(),this.activePicker=null,this.activePickerQueueIndex=-1,a.call(this,e,{self:this,state:"close"})}.bind(this),t.animateTime),this):this},this.main=function(){arguments&&i.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};t.picker=function(){return i.isFunction(e)&&(n.prototype=new e),n}()}(ax5.ui,ax5.ui.root),ax5.ui.picker_instance=new ax5.ui.picker,jQuery.fn.ax5picker=function(){return function(t){if(ax5.util.isString(arguments[0])){var e=arguments[0];switch(e){case"open":return ax5.ui.select_instance.open(this);case"close":return ax5.ui.select_instance.close(this);case"setValue":return ax5.ui.select_instance.setContentValue(this,arguments[1],arguments[2]);default:return this}}else"undefined"==typeof t&&(t={}),jQuery.each(this,function(){var e={target:this};t=jQuery.extend(!0,t,e),ax5.ui.picker_instance.bind(t)});return this}}();