"use strict";!function(t,e){var i=ax5.util,n=function(){var t,n=this;e&&e.call(this),this.queue=[],this.config={clickEventName:"click",theme:"default",title:"",lang:{ok:"ok",cancel:"cancel"},animateTime:250},this.activePicker=null,this.activePickerQueueIndex=-1,this.openTimer=null,this.closeTimer=null,t=this.config;var c=function(t,e){return t&&t.onStateChanged?t.onStateChanged.call(e,e):this.onStateChanged&&this.onStateChanged.call(e,e),!0},a=function(){var e={focus:function(t,e,i){this.open(t,e)},click:function(t,e,i){this.open(t,e)}},n={"@fn":function(e,i){var n={},c=e.$target.find('input[type="text"]').length;n={inputLength:c},c>1&&(n.btns={ok:{label:t.lang.ok,theme:t.theme}}),this.queue[i]=jQuery.extend(!0,n,e),n=null,c=null},date:function(e,i){var n=e.content?e.content.width||270:270,c=e.content?e.content.margin||5:5,a={},r=e.$target.find('input[type="text"]').length;a={contentWidth:n*r+(r-1)*c,content:{width:n,margin:c},inputLength:r},r>1&&!e.btns&&(a.btns={ok:{label:t.lang.ok,theme:t.theme}}),this.queue[i]=jQuery.extend(!0,a,e),n=null,c=null,a=null,r=null}};return function(t,c){var a;if(!t.content)return console.log(ax5.info.getError("ax5picker","501","bind")),this;if(i.isFunction(t.content))n["@fn"].call(this,t,c);else for(var r in n)if(t.content.type==r){n[r].call(this,t,c);break}return a="INPUT"==t.$target.get(0).tagName.toUpperCase()?t.$target:t.$target.find('input[type="text"]'),a.unbind("focus.ax5picker").unbind("click.ax5picker").bind("focus.ax5picker",e.focus.bind(this,this.queue[c],c)).bind("click.ax5picker",e.click.bind(this,this.queue[c],c)),t.$target.find(".input-group-addon").unbind("click.ax5picker").bind("click.ax5picker",e.click.bind(this,this.queue[c],c)),t.content.formatter&&ax5.ui.formatter&&a.ax5formatter(t.content.formatter),a=null,t=null,c=null,this}}(),r=function(t,e){return'\n                <div class="ax5-ui-picker {{theme}}" id="{{id}}" data-picker-els="root">\n                    {{#title}}\n                        <div class="ax-picker-heading">{{title}}</div>\n                    {{/title}}\n                    <div class="ax-picker-body">\n                        <div class="ax-picker-content" data-picker-els="content" style="width:{{contentWidth}}px;"></div>\n                        {{#btns}}\n                            <div class="ax-picker-buttons">\n                            {{#btns}}\n                                {{#@each}}\n                                <button data-picker-btn="{{@key}}" class="btn btn-default {{@value.theme}}">{{@value.label}}</button>\n                                {{/@each}}\n                            {{/btns}}\n                            </div>\n                        {{/btns}}\n                    </div>\n                    <div class="ax-picker-arrow"></div>\n                </div>\n                '},s=function(t){if(!this.activePicker)return this;var e=this.queue[this.activePickerQueueIndex],i={},n={};t&&jQuery(document.body).append(this.activePicker),i=e.$target.offset(),n={width:e.$target.outerWidth(),height:e.$target.outerHeight()},e.direction&&""!==e.direction&&"auto"!==e.direction||(e.direction="top"),t&&this.activePicker.addClass("direction-"+e.direction),this.activePicker.css(function(){return"top"==e.direction?{left:i.left+n.width/2-this.activePicker.outerWidth()/2,top:i.top+n.height+12}:"bottom"==e.direction?{left:i.left+n.width/2-this.activePicker.outerWidth()/2,top:i.top-this.activePicker.outerHeight()-12}:"left"==e.direction?{left:i.left+n.width+12,top:i.top-n.height/2}:"right"==e.direction?{left:i.left-this.activePicker.outerWidth()-12,top:i.top-n.height/2}:void 0}.call(this))},u=function(t,e){if(!this.activePicker)return this;var n=this.queue[this.activePickerQueueIndex];return e=i.findParentNode(t.target,function(t){return t.getAttribute("data-picker-els")?!0:n.$target.get(0)==t?!0:void 0}),e?this:(this.close(),this)},o=function(t,e){if(t.srcElement&&(t.target=t.srcElement),e=i.findParentNode(t.target,function(t){return t.getAttribute("data-picker-btn")?!0:void 0})){var n=this.queue[this.activePickerQueueIndex],c=e.getAttribute("data-picker-btn");if(n.btns&&n.btns[c].onClick){var a={key:c,value:n.btns[c],self:this,boundObject:n};n.btns[c].onClick.call(a,c)}else this.close()}},h=function(t){t.keyCode==ax5.info.eventKeys.ESC&&this.close()};this.init=function(){this.onStateChanged=t.onStateChanged},this.bind=function(e){var n,c={};return e=jQuery.extend(!0,c,t,e),e.target?(e.$target=jQuery(e.target),e.id||(e.id=e.$target.data("ax5-picker")),e.id||(e.id="ax5-picker-"+ax5.getGuid(),e.$target.data("ax5-picker",e.id)),n=i.search(this.queue,function(){return this.id==e.id}),-1===n?(this.queue.push(e),a.call(this,e,this.queue.length-1)):(jQuery.extend({},this.queue[n],e),a.call(this,this.queue[n],n)),c=null,n=null,this):(console.log(ax5.info.getError("ax5picker","401","bind")),this)},this.setContentValue=function(t,e,i){var n=this.queue[ax5.util.search(this.queue,function(){return this.id==t})];return n&&(jQuery(n.$target.find('input[type="text"]').get(e)).val(i),1==n.inputLength&&this.close()),n=null,t=null,e=null,i=null,this},this.open=function(){var e={"@fn":function(t,e,i){return t.content.call(t,function(t){i(t)}),!0},date:function(t,e){for(var c=[],a=0;a<t.inputLength;a++)c.push('<div style="width:'+i.cssNumber(t.content.width)+';float:left;" class="ax-picker-content-box" data-calendar-target="'+a+'"></div>'),a<t.inputLength-1&&c.push('<div style="width:'+t.content.margin+'px;float:left;height: 5px;"></div>');c.push('<div style="clear:both;"></div>'),t.pickerContent.html(c.join(""));var r={displayDate:new Date,control:{left:'<i class="fa fa-chevron-left"></i>',yearTmpl:"%s",monthTmpl:"%s",right:'<i class="fa fa-chevron-right"></i>',yearFirst:!0}};t.pickerContent.find("[data-calendar-target]").each(function(e){var i=t.$target.find('input[type="text"]').get(e).value,c=ax5.util.date(i);r.displayDate=c,i&&(r.selection=[c]),r=jQuery.extend(!0,r,t.content.config||{}),r.target=this,r.onClick=function(){n.setContentValue(t.id,e,this.date)},new ax5.ui.calendar(r)})}};return function(n,a,l){if(i.isString(n)&&"undefined"==typeof a&&(a=ax5.util.search(this.queue,function(){return this.id==n}),n=this.queue[a],-1==a))return console.log(ax5.info.getError("ax5picker","402","open")),this;if(this.openTimer&&clearTimeout(this.openTimer),this.activePicker)return this.activePickerQueueIndex==a?this:l>2?this:(this.close(),this.openTimer=setTimeout(function(){this.open(n,a,(l||0)+1)}.bind(this),t.animateTime),this);if(this.activePicker=jQuery(ax5.mustache.render(r.call(this,n,a),n)),this.activePickerQueueIndex=a,n.pickerContent=this.activePicker.find('[data-picker-els="content"]'),i.isFunction(n.content))n.pickerContent.html("Loading.."),e["@fn"].call(this,n,a,function(t){n.pickerContent.html(t)});else for(var d in e)if(n.content.type==d){e[d].call(this,n,a);break}return this.activePicker.find("[data-picker-btn]").on(t.clickEventName,function(t){o.call(this,t||window.event,n,a)}.bind(this)),s.call(this,"append"),jQuery(window).bind("resize.ax5picker",function(){s.call(this)}.bind(this)),jQuery(window).bind("keyup.ax5picker",function(t){t=t||window.event,h.call(this,t),i.stopEvent(t)}.bind(this)),jQuery(window).bind("click.ax5picker",function(t){t=t||window.event,u.call(this,t),i.stopEvent(t)}.bind(this)),c.call(this,n,{self:this,state:"open",boundObject:n}),this}}(),this.close=function(e){return this.closeTimer&&clearTimeout(this.closeTimer),this.activePicker?(e=this.queue[this.activePickerQueueIndex],this.activePicker.addClass("destroy"),jQuery(window).unbind("resize.ax5picker"),jQuery(window).unbind("click.ax5picker"),jQuery(window).unbind("keyup.ax5picker"),this.closeTimer=setTimeout(function(){this.activePicker&&this.activePicker.remove(),this.activePicker=null,this.activePickerQueueIndex=-1,c.call(this,e,{self:this,state:"close"})}.bind(this),t.animateTime),this):this},this.main=function(){arguments&&i.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};t.picker=function(){return i.isFunction(e)&&(n.prototype=new e),n}()}(ax5.ui,ax5.ui.root),ax5.ui.picker_instance=new ax5.ui.picker,$.fn.ax5picker=function(){return function(t){return"undefined"==typeof t&&(t={}),$.each(this,function(){var e={target:this};t=$.extend(!0,t,e),ax5.ui.picker_instance.bind(t)}),this}}();